Homework 2 - P8105 Data Science I
================
Yongyan Liu (yl6107)
2025-09-13

- [Problem 1](#problem-1)
- [Problem 2](#problem-2)
- [Peoblem 3](#peoblem-3)

``` r
library(tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.4     ✔ readr     2.1.5
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.1
    ## ✔ ggplot2   3.5.2     ✔ tibble    3.3.0
    ## ✔ lubridate 1.9.4     ✔ tidyr     1.3.1
    ## ✔ purrr     1.1.0     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

# Problem 1

First, clean the data in pols-month.csv.

- Use separate() to break up the variable mon into integer variables
  year, month, and day;
- Replace month number with month name;
- Create a president variable taking values gop and dem, and remove
  prez_dem and prez_gop;
- Remove the day variable.

``` r
pols <- read_csv(file.path("./data/fivethirtyeight", "pols-month.csv"), show_col_types = FALSE) |>
  janitor::clean_names() |>
  separate(mon, into = c("year", "month", "day"), convert = TRUE) |>
  mutate(
    month = month.name[month],
    president = if_else(prez_gop == 1, "gop", "dem")
  ) |>
  select(-prez_gop, -prez_dem, -day) |>
  # Arrange by year and calendar order of month
  mutate(month = factor(month, levels = month.name, ordered = TRUE)) |>
  arrange(year, month)
  
list(
  head_rows = head(pols, 10),
  tail_rows = tail(pols, 10)
)
```

    ## $head_rows
    ## # A tibble: 10 × 9
    ##     year month     gov_gop sen_gop rep_gop gov_dem sen_dem rep_dem president
    ##    <int> <ord>       <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl> <chr>    
    ##  1  1947 January        23      51     253      23      45     198 dem      
    ##  2  1947 February       23      51     253      23      45     198 dem      
    ##  3  1947 March          23      51     253      23      45     198 dem      
    ##  4  1947 April          23      51     253      23      45     198 dem      
    ##  5  1947 May            23      51     253      23      45     198 dem      
    ##  6  1947 June           23      51     253      23      45     198 dem      
    ##  7  1947 July           23      51     253      23      45     198 dem      
    ##  8  1947 August         23      51     253      23      45     198 dem      
    ##  9  1947 September      23      51     253      23      45     198 dem      
    ## 10  1947 October        23      51     253      23      45     198 dem      
    ## 
    ## $tail_rows
    ## # A tibble: 10 × 9
    ##     year month     gov_gop sen_gop rep_gop gov_dem sen_dem rep_dem president
    ##    <int> <ord>       <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl> <chr>    
    ##  1  2014 September      29      45     234      21      53     199 dem      
    ##  2  2014 October        29      45     234      21      53     199 dem      
    ##  3  2014 November       29      45     235      21      53     201 dem      
    ##  4  2014 December       29      45     235      21      53     201 dem      
    ##  5  2015 January        31      54     245      18      44     188 dem      
    ##  6  2015 February       31      54     245      18      44     188 dem      
    ##  7  2015 March          31      54     245      18      44     188 dem      
    ##  8  2015 April          31      54     244      18      44     188 dem      
    ##  9  2015 May            31      54     245      18      44     188 dem      
    ## 10  2015 June           31      54     246      18      44     188 dem

Second, clean the data in snp.csv using a similar process to the above.
For consistency across datasets, arrange according to year and month,
and organize so that year and month are the leading columns.

``` r
snp <- read_csv(file.path("./data/fivethirtyeight", "snp.csv"), show_col_types = FALSE) |>
  janitor::clean_names() |>
  mutate(date = mdy(date)) |>
  transmute(
    year = year(date),
    month = month.name[month(date)],
    close
  ) |>
  mutate(month = factor(month, levels = month.name, ordered = TRUE)) |>
  arrange(year, month)

list(
  head_rows = head(snp, 10),
  tail_rows = tail(snp, 10)
)
```

    ## $head_rows
    ## # A tibble: 10 × 3
    ##     year month     close
    ##    <dbl> <ord>     <dbl>
    ##  1  1969 January   103. 
    ##  2  1969 February   98.1
    ##  3  1969 March     102. 
    ##  4  1969 April     104. 
    ##  5  1969 May       103. 
    ##  6  1969 June       97.7
    ##  7  1969 July       91.8
    ##  8  1969 August     95.5
    ##  9  1969 September  93.1
    ## 10  1969 October    97.1
    ## 
    ## $tail_rows
    ## # A tibble: 10 × 3
    ##     year month     close
    ##    <dbl> <ord>     <dbl>
    ##  1  2068 March      90.2
    ##  2  2068 April      97.5
    ##  3  2068 May        98.7
    ##  4  2068 June       99.6
    ##  5  2068 July       97.7
    ##  6  2068 August     98.9
    ##  7  2068 September 103. 
    ##  8  2068 October   103. 
    ##  9  2068 November  108. 
    ## 10  2068 December  104.

Third, tidy the unemployment data so that it can be merged with the
previous datasets. - Switching from “wide” to “long” format; - Ensuring
that key variables have the same name; - Ensuring that key variables
take the same values.

``` r
unemp <- read_csv(file.path("./data/fivethirtyeight", "unemployment.csv"), show_col_types = FALSE) |>
  pivot_longer(
    cols = Jan:Dec,
    names_to = "month",
    values_to = "unemployment"
  ) |>
  janitor::clean_names() |>
  mutate(
    month = month.name[match(month, month.abb)],
    month = factor(month, levels = month.name, ordered = TRUE)
  ) |>
  arrange(year, month)

list(
  head_rows = head(unemp, 10),
  tail_rows = tail(unemp, 10)
)
```

    ## $head_rows
    ## # A tibble: 10 × 3
    ##     year month     unemployment
    ##    <dbl> <ord>            <dbl>
    ##  1  1948 January            3.4
    ##  2  1948 February           3.8
    ##  3  1948 March              4  
    ##  4  1948 April              3.9
    ##  5  1948 May                3.5
    ##  6  1948 June               3.6
    ##  7  1948 July               3.6
    ##  8  1948 August             3.9
    ##  9  1948 September          3.8
    ## 10  1948 October            3.7
    ## 
    ## $tail_rows
    ## # A tibble: 10 × 3
    ##     year month     unemployment
    ##    <dbl> <ord>            <dbl>
    ##  1  2015 March              5.5
    ##  2  2015 April              5.4
    ##  3  2015 May                5.5
    ##  4  2015 June               5.3
    ##  5  2015 July              NA  
    ##  6  2015 August            NA  
    ##  7  2015 September         NA  
    ##  8  2015 October           NA  
    ##  9  2015 November          NA  
    ## 10  2015 December          NA

Join the datasets

- Left-join `snp` into `pols` by `year` + `month`.
- Then left-join `unemp`.

``` r
merged_df <- left_join(pols, snp, by = c("year", "month")) |>
  left_join(unemp, by = c("year", "month"))

# Since the date range of the three tables is different, some of the column is NA. Let's show the rows without NA columns.
merged_df |> filter(!is.na(close) & !is.na(unemployment)) |>
  glimpse()
```

    ## Rows: 558
    ## Columns: 11
    ## $ year         <dbl> 1969, 1969, 1969, 1969, 1969, 1969, 1969, 1969, 1969, 196…
    ## $ month        <ord> January, February, March, April, May, June, July, August,…
    ## $ gov_gop      <dbl> 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 32, 32, 3…
    ## $ sen_gop      <dbl> 43, 43, 43, 43, 43, 43, 43, 43, 43, 43, 43, 43, 43, 43, 4…
    ## $ rep_gop      <dbl> 199, 199, 199, 199, 199, 199, 199, 199, 199, 199, 199, 19…
    ## $ gov_dem      <dbl> 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 20, 20, 2…
    ## $ sen_dem      <dbl> 57, 57, 57, 57, 57, 57, 57, 57, 57, 57, 57, 57, 58, 58, 5…
    ## $ rep_dem      <dbl> 250, 250, 250, 250, 250, 250, 250, 250, 250, 250, 250, 25…
    ## $ president    <chr> "gop", "gop", "gop", "gop", "gop", "gop", "gop", "gop", "…
    ## $ close        <dbl> 103.01, 98.13, 101.51, 103.69, 103.46, 97.71, 91.83, 95.5…
    ## $ unemployment <dbl> 3.4, 3.4, 3.4, 3.4, 3.4, 3.5, 3.5, 3.5, 3.7, 3.7, 3.5, 3.…

# Problem 2

# Peoblem 3
